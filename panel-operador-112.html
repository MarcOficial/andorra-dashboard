<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Operador 112 - Spanish City RP</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<style>
  body { background-color: #f8f9fa; }
  .left-panel { height: 90vh; overflow-y: auto; }
  .right-panel { height: 90vh; overflow-y: auto; }
  .fixed-bottom-left { position: fixed; bottom: 20px; left: 20px; }
  .offcanvas { width: 350px; }
</style>
</head>
<body>
<header>
  <nav class="navbar navbar-expand-lg shadow p-3 bg-white">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold fs-4" href="dashboard.html">‚õ∞Ô∏è Spanish City RP</a>
      <button class="btn btn-warning fw-bold ms-auto" data-bs-toggle="modal" data-bs-target="#modalUnidad">NOT SET</button>
    </div>
  </nav>
</header>

<div class="container-fluid mt-3">
  <div class="row">
    <!-- Panel izquierdo -->
    <div class="col-md-4 left-panel">
      <h5 class="fw-bold">üöî Unidades Activas</h5>
      <ul id="listaUnidades" class="list-group mb-3"></ul>

      <h5 class="fw-bold">üë• Grupos de Unidades</h5>
      <ul id="gruposUnidades" class="list-group mb-3">
        <li class="list-group-item text-muted">Ning√∫n grupo creado</li>
      </ul>

      <h5 class="fw-bold">üìû Llamadas Activas</h5>
      <ul id="llamadasActivas" class="list-group">
        <li class="list-group-item text-muted">No hay llamadas</li>
      </ul>
    </div>

    <!-- Panel derecho -->
    <div class="col-md-8 right-panel">
      <h4 class="fw-bold">‚ûï Nueva Emergencia</h4>
      <form id="formEmergencia" class="mb-4">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Unidades</label>
            <input type="text" class="form-control" id="unidades">
          </div>
          <div class="col-md-4">
            <label class="form-label">Prioridad</label>
            <select class="form-select" id="prioridad">
              <option>Baja</option>
              <option>Media</option>
              <option>Alta</option>
            </select>
          </div>
          <div class="col-md-4">
            <label class="form-label">Direcci√≥n Postal</label>
            <input type="text" class="form-control" id="direccion">
          </div>
          <div class="col-md-6">
            <label class="form-label">T√≠tulo de Llamada</label>
            <input type="text" class="form-control" id="tituloLlamada">
          </div>
          <div class="col-md-6">
            <label class="form-label">C√≥digo</label>
            <input type="text" class="form-control" id="codigo">
          </div>
          <div class="col-md-6">
            <label class="form-label">Unidad Primaria</label>
            <input type="text" class="form-control" id="unidadPrimaria">
          </div>
          <div class="col-md-12">
            <label class="form-label">Descripci√≥n</label>
            <textarea class="form-control" id="descripcion" rows="3"></textarea>
          </div>
        </div>
        <button class="btn btn-success mt-3 w-100">Crear Llamada</button>
      </form>

      <h5 class="fw-bold">üìû Llamadas Activas</h5>
      <ul id="listaLlamadasActivas" class="list-group mb-3"></ul>

      <h5 class="fw-bold">üìú Historial de Llamadas</h5>
      <ul id="historialLlamadas" class="list-group"></ul>
    </div>
  </div>
</div>

<!-- Bot√≥n fijo Registros -->
<button class="btn btn-dark fixed-bottom-left" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRegistros">
  üìÇ Registros
</button>

<!-- Panel lateral de registros -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasRegistros">
  <div class="offcanvas-header">
    <h5>üìÇ Panel de Registros</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>
  <div class="offcanvas-body">
    <p><strong>MIS ARCHIVOS</strong></p>
    <button class="btn btn-primary w-100 mb-2">Actualizar</button>
    <button class="btn btn-outline-secondary w-100 mb-2">Reportes (0)</button>
    <button class="btn btn-outline-secondary w-100 mb-2">Registros (0)</button>
    <button class="btn btn-outline-dark w-100 mb-2">Buscar</button>
    <button class="btn btn-success w-100 mb-2">Nuevo Informe</button>
    <button class="btn btn-warning w-100 mb-2">Nuevo Registro</button>
    <button class="btn btn-danger w-100">Panel Supervisor</button>
  </div>
</div>

<!-- Modal NOT SET -->
<div class="modal fade" id="modalUnidad" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content shadow-lg rounded-3">
      <div class="modal-header">
        <h5 class="modal-title">Modificar identificador: NOT SET</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="formUnidad">
          <div class="mb-3">
            <label class="form-label">N√∫mero de unidad</label>
            <input type="text" class="form-control" id="numeroUnidad" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" class="form-control" id="nombreUnidad" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Rango</label>
            <input type="text" class="form-control" id="rangoUnidad">
          </div>
          <div class="mb-3">
            <label class="form-label">Estatus</label>
            <select id="estatusUnidad" class="form-select">
              <option>DISPONIBLE</option>
              <option>OCUPADO</option>
              <option>FUERA DE SERVICIO</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Ubicaci√≥n</label>
            <input type="text" class="form-control" id="ubicacionUnidad">
          </div>
          <div class="mb-3">
            <label class="form-label">Agencia</label>
            <select id="agenciaUnidad" class="form-select" required>
              <option value="">Selecciona</option>
              <option value="Polic√≠a">Polic√≠a</option>
              <option value="Bomberos">Bomberos</option>
              <option value="SAMU">SAMU</option>
              <option value="UME">UME</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Departamento</label>
            <select id="departamentoUnidad" class="form-select" required></select>
          </div>
          <div class="mb-3">
            <label class="form-label">Subdivisi√≥n</label>
            <select id="subdivisionUnidad" class="form-select"></select>
          </div>
          <button type="submit" class="btn btn-success w-100">Guardar</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Departamentos y subdivisiones actualizados con Valencia + UME
const departamentos = {
  "Polic√≠a": ["Guardia Civil", "Polic√≠a Nacional", "Polic√≠a Local Valencia"],
  "Bomberos": ["Bomberos Valencia", "Unidad Forestal"],
  "SAMU": ["Emergencias B√°sicas", "Emergencias Avanzadas"],
  "UME": ["UMED Valencia"]
};

const subdivisiones = {
  "Guardia Civil": ["Tr√°fico", "Seguridad Ciudadana", "SEPRONA", "GRS"],
  "Polic√≠a Nacional": ["UIP", "UDEF", "Brigada Judicial", "Grupo de Menores (GRUME)"],
  "Polic√≠a Local Valencia": ["Tr√°fico", "Barrio del Carmen", "Grupo GAMA", "Unidad Canina"],
  "Bomberos Valencia": ["Incendios Urbanos", "Rescate", "Forestales"],
  "Unidad Forestal": ["Incendios Forestales", "Rescate en Monta√±a"],
  "Emergencias B√°sicas": ["Ambulancia SVB 1", "Ambulancia SVB 2"],
  "Emergencias Avanzadas": ["UVI M√≥vil", "Helic√≥ptero Medicalizado"],
  "UMED Valencia": ["Intervenci√≥n en Incendios", "Intervenci√≥n en Inundaciones", "Apoyo Log√≠stico"]
};

// Din√°mico Departamento/Subdivisi√≥n
document.getElementById("agenciaUnidad").addEventListener("change", e => {
  let deptSelect = document.getElementById("departamentoUnidad");
  deptSelect.innerHTML = "";
  let selected = e.target.value;
  if(departamentos[selected]){
    departamentos[selected].forEach(dep => {
      let opt = document.createElement("option");
      opt.value = dep;
      opt.textContent = dep;
      deptSelect.appendChild(opt);
    });
    deptSelect.dispatchEvent(new Event("change"));
  }
});
document.getElementById("departamentoUnidad").addEventListener("change", e => {
  let subSelect = document.getElementById("subdivisionUnidad");
  subSelect.innerHTML = "";
  let selected = e.target.value;
  if(subdivisiones[selected]){
    subdivisiones[selected].forEach(sub => {
      let opt = document.createElement("option");
      opt.value = sub;
      opt.textContent = sub;
      subSelect.appendChild(opt);
    });
  }
});

// Guardar unidad
document.getElementById("formUnidad").addEventListener("submit", e => {
  e.preventDefault();
  let unidad = {
    numero: document.getElementById("numeroUnidad").value,
    nombre: document.getElementById("nombreUnidad").value,
    rango: document.getElementById("rangoUnidad").value,
    estatus: document.getElementById("estatusUnidad").value,
    ubicacion: document.getElementById("ubicacionUnidad").value,
    agencia: document.getElementById("agenciaUnidad").value,
    departamento: document.getElementById("departamentoUnidad").value,
    subdivision: document.getElementById("subdivisionUnidad").value
  };
  let unidades = JSON.parse(localStorage.getItem("unidades")) || [];
  unidades.push(unidad);
  localStorage.setItem("unidades", JSON.stringify(unidades));
  actualizarListaUnidades();
  bootstrap.Modal.getInstance(document.getElementById("modalUnidad")).hide();
  document.getElementById("formUnidad").reset();
});

// Mostrar unidades activas
function actualizarListaUnidades(){
  let lista = document.getElementById("listaUnidades");
  lista.innerHTML = "";
  let unidades = JSON.parse(localStorage.getItem("unidades")) || [];
  if(unidades.length === 0){
    let li = document.createElement("li");
    li.textContent = "No hay unidades activas";
    li.className = "list-group-item text-muted";
    lista.appendChild(li);
    return;
  }
  unidades.forEach(u => {
    let li = document.createElement("li");
    li.className = "list-group-item";
    li.textContent = `${u.agencia} - ${u.departamento} - ${u.subdivision} (${u.estatus})`;
    lista.appendChild(li);
  });
}

actualizarListaUnidades();
</script>
</body>
</html>
